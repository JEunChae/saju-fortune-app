import { getStem, getBranch, getElementByStem } from "./ganji";

export type Pillar = {
  stem: string;
  branch: string;
  element: string;
  sibshin?: string;
  branchSibshin?: string[];
  unseong?: string;
};

// 🔹 전체 result 구조 타입 정의
export interface PillarSet {
  year: Pillar;
  month: Pillar;
  day: Pillar;
  hour: Pillar;
}


export function interpretFortuneDetail(pillars: PillarSet, currentYear: number) {
  const { year, month, day, hour } = pillars;
  const dayElement = day.element;
  const dayStem = day.stem;
  const monthElement = month.element;

  // 오행 상생/상극 관계 정의
  const generate: Record<string, string> = {
    목: "화", 화: "토", 토: "금", 금: "수", 수: "목",
  };
  const control: Record<string, string> = {
    목: "토", 화: "금", 토: "수", 금: "목", 수: "화",
  };

  const currentYearStem = getStem((currentYear - 4) % 10).name;
  const currentYearBranch = getBranch((currentYear - 4) % 12).name;
  const currentYearElement = getElementByStem(currentYearStem);

  // ===========================================
  // 🌳 평생사주 + 대운 (확장형)
  // ===========================================
  let lifetime = "";
  if (dayElement === "목") {
    lifetime = `
당신은 ‘목(木)’의 사람입니다.  
인생의 기운은 ‘성장’과 ‘확장’을 상징합니다. 어떤 환경에서도 새로운 길을 개척하고자 하는 강한 의지를 지니며, 실패를 통해 배우고 다시 일어서는 회복력이 탁월합니다.  
성격적으로는 진취적이고 논리적이며, 타인을 돕는 데서 보람을 느낍니다. 그러나 때로는 자신의 신념이 지나치게 강해 융통성을 잃을 수 있습니다.  

🌱 **대운 흐름**
- **초년기(0~20세)**: 배움과 시행착오의 시기입니다. 불안정하지만, 이때 쌓은 경험이 인생의 근간이 됩니다.  
- **중년기(20~50세)**: 사회적 성장과 재물운이 강하게 작용합니다. 특히 30대 중반 이후 리더십이 강화되며, 스스로의 분야를 개척할 가능성이 높습니다.  
- **장년기(50세 이후)**: 인간관계가 인생의 중심이 됩니다. 후배를 이끌거나 가르치는 운이 강하며, ‘정신적 스승’으로 존경받을 수 있습니다.  
`;
  } else if (dayElement === "화") {
    lifetime = `
당신은 ‘화(火)’의 사람입니다.  
열정과 창의력, 그리고 강한 감정 에너지를 가진 사람으로, 세상에 빛과 온기를 전하려는 존재입니다.  
삶의 중심은 ‘표현’과 ‘영감’이며, 타인의 감정을 빠르게 읽고 공감하는 능력이 탁월합니다. 다만 감정의 폭이 넓기 때문에, 때로는 스스로를 소모할 위험이 있습니다.  

🔥 **대운 흐름**
- **초년기(0~20세)**: 빠르게 세상을 배우며 감정의 깊이를 키우는 시기입니다. 예술적, 감성적 재능이 싹트며, 새로운 환경에 강한 적응력을 보입니다.  
- **중년기(20~50세)**: 사회적 리더십이 강화되고, 명예운이 들어옵니다. 타인을 이끄는 역할이 많아지며, ‘불의 중심’에서 빛나는 시기입니다.  
- **장년기(50세 이후)**: 내면의 열정을 정화시키는 시기입니다. 가족, 제자, 후배와의 관계에서 ‘삶의 의미’를 찾게 됩니다.  
`;
  } else if (dayElement === "토") {
    lifetime = `
당신은 ‘토(土)’의 사람입니다.  
균형과 안정, 책임감이 인생의 근본입니다. 현실 감각이 뛰어나고, 주변의 혼란을 정리하는 능력이 탁월합니다.  
세상에 뿌리를 내리고, 타인에게 신뢰를 주는 것이 큰 복입니다. 그러나 지나친 완벽주의는 삶의 유연함을 방해할 수 있습니다.  

🌾 **대운 흐름**
- **초년기(0~20세)**: 안정적이지만 다소 답답한 환경 속에서 기본기를 다집니다.  
- **중년기(20~50세)**: 재물, 부동산, 조직적 리더십이 강화되는 시기입니다. 인내와 책임이 결실을 맺습니다.  
- **장년기(50세 이후)**: 안정의 정점을 찍습니다. 가족과 제자에게 귀감이 되며, 사회적 명예가 유지됩니다.  
`;
  } else if (dayElement === "금") {
    lifetime = `
당신은 ‘금(金)’의 사람입니다.  
이성적 판단력, 결단력, 그리고 명확한 목표 의식을 갖춘 인물입니다.  
스스로의 신념이 확고하며, 정의로운 성향으로 불의를 참지 못합니다. 하지만 완벽주의로 인해 주변과의 마찰이 생기기도 합니다.  

⚙️ **대운 흐름**
- **초년기(0~20세)**: 경쟁이 많지만, 이 시기의 시련이 훗날 큰 무기가 됩니다.  
- **중년기(20~50세)**: 재물과 명예가 함께 들어오는 시기입니다. 스스로의 이름을 세상에 각인시키게 됩니다.  
- **장년기(50세 이후)**: 통찰과 절제의 시기. 후배를 지도하고, 정신적 완숙의 단계를 밟습니다.  
`;
  } else {
    lifetime = `
당신은 ‘수(水)’의 사람입니다.  
지혜롭고 감성적이며, 변화를 두려워하지 않는 사람입니다. 흐르는 물처럼 어떤 환경에도 적응하며, 위기를 기회로 바꿀 줄 아는 순발력을 지녔습니다.  
다만 지나친 내면화는 외로움으로 이어질 수 있으니, 감정의 순환이 중요합니다.  

💧 **대운 흐름**
- **초년기(0~20세)**: 유연성과 호기심이 발달합니다. 예술, 언어, 탐구 쪽에 강한 재능이 나타납니다.  
- **중년기(20~50세)**: 대외적 활동이 많아지고, 해외, 언론, 연구 분야에서 두각을 나타낼 수 있습니다.  
- **장년기(50세 이후)**: 철학적·영적 탐구의 흐름이 강해집니다. ‘인생의 의미’를 발견하는 시기입니다.  
`;
  }

  // ===========================================
  // ☀️ 올해운세 (세운)
  // ===========================================
  let yearly = "";
  if (currentYearElement === dayElement) {
    yearly = `
올해(${currentYear}년)는 당신의 본기운(${dayElement})이 가장 강하게 작용합니다.  
자존감, 의지, 추진력이 동시에 폭발하며, 인생의 주도권을 완전히 자신이 쥐게 됩니다.  
직업적으로는 ‘스스로의 이름’을 내세우는 시기이며, 개인적 결단이 인생의 방향을 바꿀 수도 있습니다.  
다만 고집이 강해지고 감정의 기복이 심해질 수 있으므로, 신중한 선택이 필요합니다.  
하반기로 갈수록 주변의 인정과 협력자가 늘어나며, 계획한 일의 결실을 보게 됩니다.
`;
  } else if (generate[dayElement] === currentYearElement) {
    yearly = `
올해(${currentYear}년)는 성장과 확장의 시기입니다.  
당신이 흘려보낸 노력들이 현실의 결과로 돌아옵니다.  
특히 새로운 직업적 기회, 프로젝트, 사업 제안이 잇따를 수 있습니다.  
이 시기에는 적극적인 도전이 행운을 부르지만, 방향성을 잃으면 쉽게 지칠 수 있습니다.  
하반기에는 해외, 공부, 이직운이 열리며 ‘새로운 무대’가 시작됩니다.
`;
  } else if (control[dayElement] === currentYearElement) {
    yearly = `
올해(${currentYear}년)는 시련과 인내의 해입니다.  
외부 환경의 압박이 커지고, 뜻하지 않은 변수로 인해 계획이 지연될 수 있습니다.  
그러나 이 시기는 당신의 내면을 단련시키는 ‘운명의 훈련장’입니다.  
마음의 중심을 잃지 않는다면, 내년 이후 더 큰 반전을 맞이할 수 있습니다.  
특히 여름철에는 건강과 인간관계 모두 균형이 필요합니다.
`;
  } else {
    yearly = `
올해(${currentYear}년)는 변화와 전환의 흐름이 교차합니다.  
새로운 사람, 환경, 기회가 잇따라 들어오지만, 모든 걸 잡으려 하면 오히려 혼란이 옵니다.  
당신의 ‘핵심 가치’를 분명히 하고, 불필요한 욕심을 버릴수록 운이 상승합니다.  
가을 이후에는 재물운과 인연운이 함께 들어오는 안정 흐름으로 전환됩니다.
`;
  }
    // ===========================================
  // ⚠️ 올해 주의할 점 (확장형)
  // ===========================================
  let caution = "";
  if (yearly.includes("시련")) {
    caution = `
올해는 외부적인 시련과 내면적 부담이 교차하는 시기입니다.  
이럴 때일수록 ‘감정적 반응’을 줄이고 ‘행동의 일관성’을 지키는 것이 중요합니다.  
특히 주변의 기대와 압박 속에서 스스로의 속도를 잃기 쉽습니다.  
‘빨리 가는 것’보다 ‘끝까지 가는 것’이 핵심이에요.  
3월~5월 사이에는 일과 인간관계가 얽혀 예민한 시기가 될 수 있으므로,  
결정은 반드시 하루 이상 숙려 후에 내리는 게 좋습니다.  
`;
  } else if (yearly.includes("변화")) {
    caution = `
올해는 ‘변화의 파도’가 크게 일어나는 해입니다.  
환경이 바뀌고, 주변 인물도 교체되거나 새로운 인연이 들어옵니다.  
이 과정에서 당신의 ‘내적 확신’이 시험받게 됩니다.  
변화를 두려워하지 말고, ‘무엇을 지켜야 하는가’를 기준으로 판단하세요.  
하반기에는 한때 불안하던 관계나 프로젝트가 다시 안정 궤도에 오르지만,  
초반 5개월간은 방황이나 혼란을 감수해야 합니다.  
`;
  } else {
    caution = `
올해는 무난하지만, 방심은 금물입니다.  
겉으로는 평온하나, 내면의 피로가 누적될 수 있으니 꾸준한 휴식이 필요합니다.  
특히 금전적 판단이나 대인관계에서 ‘작은 거짓말’을 피하는 것이 좋습니다.  
겉모습보다 ‘진정성’을 기준으로 행동하면 안정된 흐름을 이어갈 수 있습니다.  
`;
  }

  // ===========================================
  // 💰 재물운 (확장형)
  // ===========================================
  let money = "";
  if (day.sibshin === "정재") {
    money = `
재물운이 안정적이고 현실적인 흐름을 보입니다.  
돈을 버는 운보다는 ‘돈을 모으는 운’이 강하게 작용합니다.  
부동산, 저축, 장기 투자처럼 ‘시간이 쌓이는 방식’에서 큰 이익이 생깁니다.  
한편, 지출 관리만 잘한다면 재정적 안정이 몇 년간 이어질 수 있습니다.  
올해는 유혹보다는 신중함이 금전의 핵심입니다.  
특히 봄~여름에는 계획한 자금 운용이 좋은 결과로 이어집니다.  
`;
  } else if (day.sibshin === "편재") {
    money = `
‘움직이는 돈’의 흐름이 강한 해입니다.  
새로운 수입원이나 부수입 기회가 생기며, 창업·프리랜스·프로젝트형 일에서 금전적 성취를 얻을 수 있습니다.  
다만, 불안정한 투자나 급격한 확장은 리스크가 큽니다.  
올해는 ‘다양한 연결’ 속에서 돈이 들어오지만,  
그만큼 지출도 커질 수 있으니 **순이익 관리**가 핵심입니다.  
여름철에는 예상치 못한 행운성 재물이 들어올 가능성도 있습니다.  
`;
  } else {
    money = `
금전운은 일정하지 않으며, 감정에 따라 재정 흐름이 요동칠 수 있습니다.  
‘돈에 대한 생각을 정리하는 해’로 보면 좋습니다.  
직장인은 보너스·성과급 운이 강하고, 자영업자는 수입이 들쭉날쭉할 수 있습니다.  
무리한 투자보다 ‘현금 흐름 관리’가 중요합니다.  
가을 이후에는 금전적으로 숨통이 트이니, 그때를 기다리며 기반을 다져야 합니다.  
`;
  }

  // ===========================================
  // 💕 애정운 (확장형)
  // ===========================================
  let love = "";
  if (month.sibshin === "정관" || month.sibshin === "정인") {
    love = `
진정성 있는 관계의 해입니다.  
감정이 깊어지고, 인연이 ‘책임’으로 이어질 가능성이 높습니다.  
연애 중이라면 결혼, 약혼, 동거 등 현실적인 진전이 이루어질 수 있습니다.  
기혼자는 부부 간 신뢰 회복의 기운이 강해집니다.  
단, 너무 ‘도덕적’이거나 ‘이성적 판단’에 치우치면 감정이 식을 수 있으니,  
감사와 애정을 표현하는 시간을 늘리세요.  
특히 5~8월은 감정의 온도가 정점에 오르며,  
오랜 인연일수록 ‘새로운 형태의 관계 재정립’이 일어납니다.  
`;
  } else if (month.sibshin === "상관") {
    love = `
감정의 폭발력이 큰 시기입니다.  
이 시기에는 ‘감정이 곧 행동’으로 이어지기 때문에,  
충동적 연애나 관계 단절이 일어나기 쉽습니다.  
하지만 반대로 보면, 진심을 숨기지 않고 표현하는 용기가 사랑의 전환점이 될 수 있습니다.  
새로운 만남이 많고, 짧은 연애운이 반복될 가능성도 있습니다.  
기혼자는 일시적 거리감이 생길 수 있으나, 대화가 복을 불러옵니다.  
`;
  } else {
    love = `
올해는 인연의 순환이 활발합니다.  
새로운 사람, 잊었던 인연이 동시에 찾아올 수 있습니다.  
특히 9월~11월 사이에는 오랜 시간 생각만 하던 관계가 현실로 발전할 수 있습니다.  
감정 표현을 솔직히 하되, 상대의 진심을 확인하는 과정이 필요합니다.  
싱글은 온라인·직장·지인 모임을 통해 좋은 인연을 만나기 쉽고,  
기혼자는 가족 내 조화와 공감이 중심이 됩니다.  
`;
  }

  // ===========================================
  // ⚙️ 능력운 (확장형)
  // ===========================================
  let ability = "";
  if (hour.sibshin === "식신" || hour.sibshin === "정재") {
    ability = `
성과 중심의 실력 발휘가 돋보이는 해입니다.  
업무·사업·창작 등 ‘형태가 남는 일’에서 인정받을 가능성이 높습니다.  
당신의 꾸준함과 책임감이 자연스레 리더십으로 이어집니다.  
동료나 상사에게 신뢰받으며, 현실적인 결과가 눈에 보이게 쌓입니다.  
다만, 욕심이 지나치면 체력 소모가 클 수 있으니  
‘속도의 조절’이 필요합니다.  
이 시기엔 한 가지 일에 집중할수록, 그 성취가 10배로 돌아옵니다.  
`;
  } else if (hour.sibshin === "편관") {
    ability = `
도전과 경쟁의 시기입니다.  
새로운 프로젝트나 역할이 주어지고, 그 과정에서 자신의 진가가 드러납니다.  
한동안 압박이 심하겠지만, 이를 견디면 커리어 전환점이 됩니다.  
특히 7~10월 사이에는 주도적 리더십이 강화되어,  
‘실력으로 사람을 이끄는’ 시기가 찾아옵니다.  
긴장 속에서도 냉정함을 잃지 않는다면, 명예운이 함께 들어옵니다.  
`;
  } else {
    ability = `
실속형 성장운입니다.  
외부의 스포트라이트보다는, 내부의 성숙과 기술적 성장에 집중해야 합니다.  
그 덕에 내년 이후 지속 가능한 기반이 형성됩니다.  
올해는 ‘작은 일의 완성도’가 당신을 빛나게 할 것이며,  
다소 느려 보여도 꾸준함이 최종 승리로 이어집니다.  
협업과 팀워크를 통해 더욱 빛날 수 있습니다.  
`;
  }

  // ===========================================
  // 🩺 건강운 (확장형)
  // ===========================================
  let health = "";
  if (dayElement === "목") {
    health = `
목(木)은 간, 근육, 신경계와 관련이 있습니다.  
스트레스가 쌓이면 피로가 전신으로 확산되기 쉽습니다.  
올해는 운동의 강도보다는 ‘균형과 유연성’을 중시해야 합니다.  
스트레칭, 요가, 명상이 도움이 되며, ‘아침 햇빛’이 건강운을 높입니다.  
감정의 억압보다는 표현이 치유로 이어집니다.  
`;
  } else if (dayElement === "화") {
    health = `
화(火)는 심장, 혈액, 체온 조절과 관련됩니다.  
열이 과하면 피로와 불면, 두통이 생기기 쉽습니다.  
올해는 ‘휴식의 질’이 건강을 결정짓습니다.  
감정적 스트레스 해소를 위해 예술활동, 여행, 자연 접촉이 좋습니다.  
가벼운 유산소 운동으로 순환을 도와주세요.  
`;
  } else if (dayElement === "토") {
    health = `
토(土)는 위장, 소화기, 비장과 깊은 관련이 있습니다.  
식습관이 건강을 좌우하는 해이므로, 과식과 야식을 피하세요.  
규칙적인 식사 리듬과 체온 관리가 핵심입니다.  
소화불량이나 복부 팽만이 잦다면 명상과 걷기가 도움이 됩니다.  
`;
  } else if (dayElement === "금") {
    health = `
금(金)은 폐, 호흡기, 피부, 치아에 영향을 줍니다.  
환절기 감기, 기관지염, 알레르기성 비염에 주의하세요.  
건조한 환경보다 ‘습도 유지’가 중요합니다.  
규칙적인 수면 패턴과 심호흡 운동이 회복력을 높입니다.  
`;
  } else {
    health = `
수(水)는 신장, 방광, 혈액순환, 하체와 관련이 깊습니다.  
혈류 순환을 돕는 스트레칭, 반신욕이 좋습니다.  
무릎, 허리, 다리 부종이 생기기 쉬우니  
‘앉은 시간 줄이기’가 건강의 핵심입니다.  
정신적 스트레스도 수기운을 막으므로, 충분한 수면이 필수입니다.  
`;
  }

  return { lifetime, yearly, caution, money, love, ability, health };
}